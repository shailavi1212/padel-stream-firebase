<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PADEL LIVE — Admin Control</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --bg-deep: #050810;
  --bg-primary: #0b0f1a;
  --bg-secondary: #111827;
  --bg-card: rgba(15, 20, 35, 0.9);
  --bg-input: rgba(10, 14, 26, 0.8);

  --neon-cyan: #00f0ff;
  --neon-purple: #a855f7;
  --neon-pink: #f472b6;
  --neon-green: #22d3ee;
  --neon-yellow: #fbbf24;
  --neon-red: #ef4444;

  --text-primary: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-bright: #ffffff;

  --radius: 6px;
  --radius-lg: 10px;
}

html, body {
  min-height: 100vh;
  background: var(--bg-deep);
  color: var(--text-primary);
  font-family: 'Rajdhani', sans-serif;
}

body::before {
  content: '';
  position: fixed;
  inset: 0;
  background:
    radial-gradient(ellipse at 15% 10%, rgba(168, 85, 247, 0.06) 0%, transparent 50%),
    radial-gradient(ellipse at 85% 90%, rgba(0, 240, 255, 0.05) 0%, transparent 50%);
  z-index: -1;
}

/* ═══════ LOGIN SCREEN ═══════ */
.login-screen {
  position: fixed;
  inset: 0;
  background: var(--bg-deep);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
  transition: opacity 0.4s, visibility 0.4s;
}

.login-screen.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

.login-box {
  background: var(--bg-card);
  border: 1px solid rgba(0, 240, 255, 0.15);
  border-radius: var(--radius-lg);
  padding: 40px 36px;
  width: 360px;
  max-width: 90%;
  text-align: center;
  backdrop-filter: blur(20px);
}

.login-box h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 18px;
  font-weight: 700;
  letter-spacing: 4px;
  color: var(--neon-cyan);
  margin-bottom: 6px;
}

.login-box p {
  font-size: 14px;
  color: var(--text-secondary);
  margin-bottom: 24px;
}

.login-box input {
  width: 100%;
  padding: 12px 16px;
  background: var(--bg-input);
  border: 1px solid rgba(0, 240, 255, 0.12);
  border-radius: var(--radius);
  color: var(--text-primary);
  font-family: 'Space Mono', monospace;
  font-size: 14px;
  outline: none;
  transition: border-color 0.3s;
  margin-bottom: 16px;
  text-align: center;
  letter-spacing: 3px;
}

.login-box input:focus { border-color: var(--neon-cyan); }

.login-box input::placeholder {
  letter-spacing: 1px;
  color: var(--text-secondary);
  opacity: 0.5;
}

.login-error {
  font-size: 13px;
  color: var(--neon-red);
  margin-bottom: 12px;
  display: none;
}

.login-box button {
  width: 100%;
  padding: 12px;
  background: linear-gradient(135deg, rgba(0, 240, 255, 0.15), rgba(168, 85, 247, 0.15));
  border: 1px solid rgba(0, 240, 255, 0.3);
  border-radius: var(--radius);
  color: var(--neon-cyan);
  font-family: 'Orbitron', sans-serif;
  font-size: 12px;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
}

.login-box button:hover {
  background: linear-gradient(135deg, rgba(0, 240, 255, 0.25), rgba(168, 85, 247, 0.25));
  box-shadow: 0 0 20px rgba(0, 240, 255, 0.2);
}

/* ═══════ ADMIN DASHBOARD ═══════ */
.admin-dashboard {
  max-width: 900px;
  margin: 0 auto;
  padding: 20px 16px 60px;
  display: none;
}

.admin-dashboard.visible { display: block; }

/* Header */
.admin-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 0;
  margin-bottom: 20px;
  border-bottom: 1px solid rgba(0, 240, 255, 0.08);
}

.admin-header h1 {
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  font-weight: 700;
  letter-spacing: 3px;
  color: var(--neon-cyan);
}

.admin-header .status {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
  color: var(--neon-green);
  font-family: 'Space Mono', monospace;
}

.admin-header .status .dot {
  width: 8px;
  height: 8px;
  background: var(--neon-green);
  border-radius: 50%;
  animation: statusPulse 2s ease-in-out infinite;
}

@keyframes statusPulse {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.4; }
}

/* Cards */
.card {
  background: var(--bg-card);
  border: 1px solid rgba(0, 240, 255, 0.08);
  border-radius: var(--radius-lg);
  padding: 20px;
  margin-bottom: 16px;
  backdrop-filter: blur(10px);
}

.card-title {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--neon-purple);
  margin-bottom: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.card-title svg {
  width: 16px;
  height: 16px;
  fill: currentColor;
}

/* Form elements */
.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  margin-bottom: 12px;
}

.form-row.single {
  grid-template-columns: 1fr;
}

.form-group {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.form-group label {
  font-size: 11px;
  font-weight: 600;
  letter-spacing: 1px;
  text-transform: uppercase;
  color: var(--text-secondary);
  font-family: 'Rajdhani', sans-serif;
}

.form-group input {
  width: 100%;
  padding: 10px 14px;
  background: var(--bg-input);
  border: 1px solid rgba(0, 240, 255, 0.08);
  border-radius: var(--radius);
  color: var(--text-primary);
  font-family: 'Rajdhani', sans-serif;
  font-size: 15px;
  font-weight: 500;
  outline: none;
  transition: border-color 0.2s;
}

.form-group input:focus { border-color: var(--neon-cyan); }

/* Score controls */
.score-controls {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.score-team {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 16px;
  background: rgba(0, 0, 0, 0.2);
  border-radius: var(--radius-lg);
  border: 1px solid rgba(0, 240, 255, 0.06);
}

.score-team.team-a { border-color: rgba(0, 240, 255, 0.12); }
.score-team.team-b { border-color: rgba(168, 85, 247, 0.12); }

.score-team-label {
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  font-weight: 600;
}

.score-team.team-a .score-team-label { color: var(--neon-cyan); }
.score-team.team-b .score-team-label { color: var(--neon-purple); }

.score-display {
  font-family: 'Orbitron', sans-serif;
  font-size: 42px;
  font-weight: 900;
  color: var(--text-bright);
  line-height: 1;
  min-width: 60px;
  text-align: center;
}

.score-btns {
  display: flex;
  gap: 8px;
}

.btn-score {
  width: 48px;
  height: 48px;
  border-radius: var(--radius);
  border: 1px solid rgba(0, 240, 255, 0.15);
  background: rgba(0, 240, 255, 0.06);
  color: var(--neon-cyan);
  font-family: 'Orbitron', sans-serif;
  font-size: 22px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.btn-score:hover {
  background: rgba(0, 240, 255, 0.15);
  box-shadow: 0 0 15px rgba(0, 240, 255, 0.2);
}

.btn-score.minus {
  border-color: rgba(239, 68, 68, 0.2);
  background: rgba(239, 68, 68, 0.06);
  color: var(--neon-red);
}

.btn-score.minus:hover {
  background: rgba(239, 68, 68, 0.15);
  box-shadow: 0 0 15px rgba(239, 68, 68, 0.2);
}

/* Sets row */
.sets-controls {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
  margin-top: 12px;
}

.sets-team {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.sets-label {
  font-size: 12px;
  color: var(--text-secondary);
  letter-spacing: 1px;
  text-transform: uppercase;
}

.sets-display {
  font-family: 'Orbitron', sans-serif;
  font-size: 24px;
  font-weight: 700;
  color: var(--neon-green);
  min-width: 30px;
  text-align: center;
}

.btn-set {
  width: 32px;
  height: 32px;
  border-radius: var(--radius);
  border: 1px solid rgba(34, 211, 238, 0.15);
  background: rgba(34, 211, 238, 0.06);
  color: var(--neon-green);
  font-family: 'Orbitron', sans-serif;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}

.btn-set:hover {
  background: rgba(34, 211, 238, 0.15);
}

.btn-set.minus {
  color: var(--neon-red);
  border-color: rgba(239, 68, 68, 0.15);
  background: rgba(239, 68, 68, 0.06);
}

/* Serve toggle */
.serve-toggle-container {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
  margin-top: 8px;
}

.serve-btn {
  padding: 10px 24px;
  border-radius: var(--radius);
  border: 1px solid rgba(251, 191, 36, 0.15);
  background: rgba(251, 191, 36, 0.04);
  color: var(--text-secondary);
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
  position: relative;
}

.serve-btn.active {
  border-color: var(--neon-yellow);
  background: rgba(251, 191, 36, 0.12);
  color: var(--neon-yellow);
  box-shadow: 0 0 15px rgba(251, 191, 36, 0.15);
}

.serve-btn:hover {
  background: rgba(251, 191, 36, 0.1);
}

.serve-icon {
  display: inline-block;
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: transparent;
  margin-right: 6px;
  vertical-align: middle;
  transition: background 0.3s;
}

.serve-btn.active .serve-icon {
  background: var(--neon-yellow);
  box-shadow: 0 0 8px rgba(251, 191, 36, 0.6);
}

.serve-switch-btn {
  padding: 10px 18px;
  border-radius: var(--radius);
  border: 1px solid rgba(244, 114, 182, 0.2);
  background: rgba(244, 114, 182, 0.06);
  color: var(--neon-pink);
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
}

.serve-switch-btn:hover {
  background: rgba(244, 114, 182, 0.15);
  box-shadow: 0 0 15px rgba(244, 114, 182, 0.15);
}

/* Reset button */
.reset-section {
  display: flex;
  justify-content: center;
  gap: 12px;
  margin-top: 20px;
}

.btn-reset {
  padding: 10px 28px;
  border-radius: var(--radius);
  border: 1px solid rgba(239, 68, 68, 0.25);
  background: rgba(239, 68, 68, 0.06);
  color: var(--neon-red);
  font-family: 'Orbitron', sans-serif;
  font-size: 11px;
  letter-spacing: 2px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.3s;
}

.btn-reset:hover {
  background: rgba(239, 68, 68, 0.15);
  box-shadow: 0 0 15px rgba(239, 68, 68, 0.15);
}

/* Toast notification */
.toast {
  position: fixed;
  bottom: 24px;
  right: 24px;
  background: rgba(15, 20, 35, 0.95);
  border: 1px solid rgba(0, 240, 255, 0.2);
  border-radius: var(--radius);
  padding: 12px 20px;
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  color: var(--neon-green);
  transform: translateY(80px);
  opacity: 0;
  transition: all 0.3s ease;
  z-index: 1000;
  backdrop-filter: blur(10px);
}

.toast.show {
  transform: translateY(0);
  opacity: 1;
}

/* Responsive */
@media (max-width: 600px) {
  .admin-dashboard { padding: 12px 10px 40px; }
  .form-row { grid-template-columns: 1fr; }
  .score-controls { grid-template-columns: 1fr; gap: 12px; }
  .sets-controls { grid-template-columns: 1fr; gap: 12px; }
  .serve-toggle-container { flex-direction: column; gap: 10px; }
  .score-display { font-size: 32px; }
}
</style>
</head>
<body>

<!-- LOGIN SCREEN -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <h1>ADMIN</h1>
    <p>Padel Live Broadcast Control</p>
    <input type="password" id="passwordInput" placeholder="Enter password" autocomplete="off">
    <div class="login-error" id="loginError">Incorrect password</div>
    <button onclick="attemptLogin()">Authenticate</button>
  </div>
</div>

<!-- ADMIN DASHBOARD -->
<div class="admin-dashboard" id="adminDashboard">

  <div class="admin-header">
    <h1>⚡ BROADCAST CONTROL</h1>
    <div class="status">
      <span class="dot"></span>
      Firebase Connected
    </div>
  </div>

  <!-- TEAM NAMES -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/></svg>
      Teams & Players
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Team A Name</label>
        <input type="text" id="teamAInput" placeholder="e.g. THUNDER" maxlength="20">
      </div>
      <div class="form-group">
        <label>Team B Name</label>
        <input type="text" id="teamBInput" placeholder="e.g. STORM" maxlength="20">
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Players A</label>
        <input type="text" id="playersAInput" placeholder="e.g. García / López">
      </div>
      <div class="form-group">
        <label>Players B</label>
        <input type="text" id="playersBInput" placeholder="e.g. Martínez / Ruiz">
      </div>
    </div>
  </div>

  <!-- SCORE & SETS -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/></svg>
      Score Control
    </div>
    <div class="score-controls">
      <div class="score-team team-a">
        <div class="score-team-label" id="scoreTeamALabel">TEAM A</div>
        <div class="score-display" id="scoreADisplay">0</div>
        <div class="score-btns">
          <button class="btn-score minus" onclick="adjustScore('A', -1)">−</button>
          <button class="btn-score" onclick="adjustScore('A', 1)">+</button>
        </div>
      </div>
      <div class="score-team team-b">
        <div class="score-team-label" id="scoreTeamBLabel">TEAM B</div>
        <div class="score-display" id="scoreBDisplay">0</div>
        <div class="score-btns">
          <button class="btn-score minus" onclick="adjustScore('B', -1)">−</button>
          <button class="btn-score" onclick="adjustScore('B', 1)">+</button>
        </div>
      </div>
    </div>

    <div class="sets-controls">
      <div class="sets-team">
        <span class="sets-label">Sets A</span>
        <button class="btn-set minus" onclick="adjustSets('A', -1)">−</button>
        <span class="sets-display" id="setsADisplay">0</span>
        <button class="btn-set" onclick="adjustSets('A', 1)">+</button>
      </div>
      <div class="sets-team">
        <span class="sets-label">Sets B</span>
        <button class="btn-set minus" onclick="adjustSets('B', -1)">−</button>
        <span class="sets-display" id="setsBDisplay">0</span>
        <button class="btn-set" onclick="adjustSets('B', 1)">+</button>
      </div>
    </div>
  </div>

  <!-- SERVE -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
      Serve Indicator
    </div>
    <div class="serve-toggle-container">
      <button class="serve-btn active" id="serveA" onclick="setServe('A')">
        <span class="serve-icon"></span>Team A Serves
      </button>
      <button class="serve-switch-btn" onclick="switchServe()">⇄ Switch</button>
      <button class="serve-btn" id="serveB" onclick="setServe('B')">
        <span class="serve-icon"></span>Team B Serves
      </button>
    </div>
  </div>

  <!-- STREAM URL -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M21 3H3c-1.11 0-2 .89-2 2v12c0 1.1.89 2 2 2h5v2h8v-2h5c1.1 0 2-.9 2-2V5c0-1.11-.9-2-2-2zm0 14H3V5h18v12zm-5-6l-7 4V7z"/></svg>
      Stream URL
    </div>
    <div class="form-row single">
      <div class="form-group">
        <label>YouTube URL or Embed URL</label>
        <input type="text" id="streamURLInput" placeholder="https://youtube.com/watch?v=... or embed URL">
      </div>
    </div>
  </div>

  <!-- SPONSORS -->
  <div class="card">
    <div class="card-title">
      <svg viewBox="0 0 24 24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
      Sponsor Images
    </div>
    <div class="form-row single">
      <div class="form-group">
        <label>Sponsor 1 — Image URL</label>
        <input type="text" id="sponsor1Input" placeholder="https://example.com/logo1.png">
      </div>
    </div>
    <div class="form-row single">
      <div class="form-group">
        <label>Sponsor 2 — Image URL</label>
        <input type="text" id="sponsor2Input" placeholder="https://example.com/logo2.png">
      </div>
    </div>
    <div class="form-row single">
      <div class="form-group">
        <label>Sponsor 3 — Image URL</label>
        <input type="text" id="sponsor3Input" placeholder="https://example.com/logo3.png">
      </div>
    </div>
  </div>

  <!-- RESET -->
  <div class="reset-section">
    <button class="btn-reset" onclick="resetScores()">Reset Scores</button>
    <button class="btn-reset" onclick="resetAll()">Reset All</button>
  </div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
<script src="firebase-config.js"></script>

<script>
// ══════════════════════════════════
// AUTH
// ══════════════════════════════════
let isAuthenticated = false;

// Check saved auth
if (sessionStorage.getItem('padel_admin_auth') === 'true') {
  isAuthenticated = true;
  document.getElementById('loginScreen').classList.add('hidden');
  document.getElementById('adminDashboard').classList.add('visible');
}

function attemptLogin() {
  const pw = document.getElementById('passwordInput').value;
  if (pw === ADMIN_PASSWORD) {
    isAuthenticated = true;
    sessionStorage.setItem('padel_admin_auth', 'true');
    document.getElementById('loginScreen').classList.add('hidden');
    document.getElementById('adminDashboard').classList.add('visible');
    initAdmin();
  } else {
    document.getElementById('loginError').style.display = 'block';
    document.getElementById('passwordInput').value = '';
    document.getElementById('passwordInput').focus();
  }
}

document.getElementById('passwordInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') attemptLogin();
});

// ══════════════════════════════════
// FIREBASE INIT
// ══════════════════════════════════
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const matchRef = db.ref('match');

// Local state
let matchData = {
  teamA: '', teamB: '',
  playersA: '', playersB: '',
  scoreA: 0, scoreB: 0,
  setsA: 0, setsB: 0,
  serving: 'A',
  streamURL: '',
  sponsors: { s1: '', s2: '', s3: '' }
};

// ══════════════════════════════════
// TOAST
// ══════════════════════════════════
let toastTimeout;
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = '✓ ' + msg;
  t.classList.add('show');
  clearTimeout(toastTimeout);
  toastTimeout = setTimeout(() => t.classList.remove('show'), 2000);
}

// ══════════════════════════════════
// SYNC FROM FIREBASE → ADMIN UI
// ══════════════════════════════════
function syncUI(data) {
  matchData = { ...matchData, ...data };

  document.getElementById('teamAInput').value = data.teamA || '';
  document.getElementById('teamBInput').value = data.teamB || '';
  document.getElementById('playersAInput').value = data.playersA || '';
  document.getElementById('playersBInput').value = data.playersB || '';
  document.getElementById('streamURLInput').value = data.streamURL || '';

  const sponsors = data.sponsors || {};
  document.getElementById('sponsor1Input').value = sponsors.s1 || '';
  document.getElementById('sponsor2Input').value = sponsors.s2 || '';
  document.getElementById('sponsor3Input').value = sponsors.s3 || '';

  updateScoreUI();
  updateServeUI();
}

function updateScoreUI() {
  document.getElementById('scoreADisplay').textContent = matchData.scoreA;
  document.getElementById('scoreBDisplay').textContent = matchData.scoreB;
  document.getElementById('setsADisplay').textContent = matchData.setsA;
  document.getElementById('setsBDisplay').textContent = matchData.setsB;
  document.getElementById('scoreTeamALabel').textContent = matchData.teamA || 'TEAM A';
  document.getElementById('scoreTeamBLabel').textContent = matchData.teamB || 'TEAM B';
}

function updateServeUI() {
  const serveA = document.getElementById('serveA');
  const serveB = document.getElementById('serveB');
  serveA.classList.toggle('active', matchData.serving === 'A');
  serveB.classList.toggle('active', matchData.serving === 'B');
}

// ══════════════════════════════════
// WRITE TO FIREBASE
// ══════════════════════════════════
function pushData(updates, msg) {
  matchRef.update(updates).then(() => {
    Object.assign(matchData, updates);
    updateScoreUI();
    updateServeUI();
    if (msg) showToast(msg);
  });
}

// Score
function adjustScore(team, delta) {
  const key = team === 'A' ? 'scoreA' : 'scoreB';
  const newVal = Math.max(0, (matchData[key] || 0) + delta);
  pushData({ [key]: newVal }, `Score ${team}: ${newVal}`);
}

// Sets
function adjustSets(team, delta) {
  const key = team === 'A' ? 'setsA' : 'setsB';
  const newVal = Math.max(0, (matchData[key] || 0) + delta);
  pushData({ [key]: newVal }, `Sets ${team}: ${newVal}`);
}

// Serve
function setServe(team) {
  pushData({ serving: team }, `Serve → Team ${team}`);
}

function switchServe() {
  const newServe = matchData.serving === 'A' ? 'B' : 'A';
  pushData({ serving: newServe }, `Serve → Team ${newServe}`);
}

// Resets
function resetScores() {
  if (!confirm('Reset scores and sets to 0?')) return;
  pushData({ scoreA: 0, scoreB: 0, setsA: 0, setsB: 0 }, 'Scores reset');
}

function resetAll() {
  if (!confirm('Reset EVERYTHING? Teams, scores, stream, sponsors?')) return;
  matchRef.set({
    teamA: '', teamB: '',
    playersA: '', playersB: '',
    scoreA: 0, scoreB: 0,
    setsA: 0, setsB: 0,
    serving: 'A',
    streamURL: '',
    sponsors: { s1: '', s2: '', s3: '' }
  }).then(() => {
    matchData = { teamA: '', teamB: '', playersA: '', playersB: '', scoreA: 0, scoreB: 0, setsA: 0, setsB: 0, serving: 'A', streamURL: '', sponsors: { s1: '', s2: '', s3: '' } };
    syncUI(matchData);
    showToast('All data reset');
  });
}

// ══════════════════════════════════
// TEXT INPUT DEBOUNCED SYNC
// ══════════════════════════════════
function debounce(fn, ms) {
  let t;
  return (...args) => { clearTimeout(t); t = setTimeout(() => fn(...args), ms); };
}

const syncText = debounce((key, val) => {
  if (key.startsWith('sponsors.')) {
    pushData({ [key]: val });
  } else {
    pushData({ [key]: val });
  }
}, 400);

function bindTextInput(elId, key) {
  document.getElementById(elId).addEventListener('input', (e) => {
    syncText(key, e.target.value);
  });
}

// ══════════════════════════════════
// INIT
// ══════════════════════════════════
function initAdmin() {
  // Listen for data
  matchRef.on('value', (snap) => {
    const data = snap.val();
    if (data) syncUI(data);
  });

  // Bind text inputs
  bindTextInput('teamAInput', 'teamA');
  bindTextInput('teamBInput', 'teamB');
  bindTextInput('playersAInput', 'playersA');
  bindTextInput('playersBInput', 'playersB');
  bindTextInput('streamURLInput', 'streamURL');
  bindTextInput('sponsor1Input', 'sponsors/s1');
  bindTextInput('sponsor2Input', 'sponsors/s2');
  bindTextInput('sponsor3Input', 'sponsors/s3');
}

// Auto-init if already authed
if (isAuthenticated) initAdmin();
</script>
</body>
</html>
